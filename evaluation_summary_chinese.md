# 知识图谱评估说明文档

## 目录
1. [评估方法详细说明](#评估方法详细说明)
2. [Poster简略版说明](#poster简略版说明)
3. [KG1可视化结果解读](#kg1可视化结果解读)
4. [Trans可视化结果解读](#trans可视化结果解读)

---

## 评估方法详细说明

### 1. 实体一致性评估 (Entity Consistency Evaluation)

#### 详细说明
**目的**：评估知识图谱中实体的去重效果和类型一致性，检测冗余实体和命名歧义问题。

**方法**：
- 使用 Sentence-BERT 模型 (all-MiniLM-L6-v2) 对所有节点标签进行语义编码
- 采用层次聚类算法 (Agglomerative Clustering) 将语义相似的节点聚类
- 距离阈值设为 0.35，控制聚类粒度

**核心指标**：
1. **唯一实体率 (Unique Entity Rate, UER)**
   - 定义：单节点簇数量占总簇数的比例
   - 计算：UER = (单节点簇数) / (总簇数)
   - 意义：衡量图谱中不冗余实体的比例，值越高表示去重效果越好

2. **类型一致性率 (Type Consistency Rate, TCR)**
   - 定义：每个簇内节点类型完全一致的簇占比
   - 计算：TCR = (类型一致簇数) / (总簇数)
   - 意义：检测同一实体是否被标注了不同类型，值为1.0表示无类型冲突

3. **命名歧义熵 (Name Ambiguity Entropy, NAE)**
   - 定义：相同标准化名称对应多种实体类型的熵值
   - 计算：对每个标准化名称计算其类型分布的信息熵
   - 意义：值越小表示命名越明确，0表示无歧义

**可视化输出**：
- 簇大小分布直方图 (cluster_size_hist.png)
- 每个簇内类型数量分布 (typecount_hist.png)
- Top-20 最歧义簇的类型分布条形图 (amb_cluster_*.png)
- 簇详情表格 (clusters.csv, top_ambiguous_clusters.csv)

---

### 2. 拓扑鲁棒性评估 (Topology Robustness Evaluation)

#### 详细说明
**目的**：分析图谱的结构健壮性，评估连通性、聚类性、社区结构和度分布特征。

**方法**：
- 将知识图谱视为无向图进行拓扑分析
- 使用 NetworkX 图论库计算多维度指标

**核心指标**：

1. **连通性 (Connectivity)**
   - **巨连通分量比例 (Giant Component Ratio)**：最大连通子图节点数占比
   - **连通分量数量 (# Components)**：孤立子图数量
   - **平均/中位数分量大小**：反映图谱碎片化程度

2. **路径特征 (Path Metrics)**
   - **平均最短路径长度 (Avg Shortest Path)**：节点间平均跳数
   - **直径 (Diameter)**：图中最远两点的最短路径长度
   - 意义：衡量信息传播效率，值越小表示知识关联越紧密

3. **聚类系数 (Clustering)**
   - **平均聚类系数 (Avg Clustering)**：节点邻居之间形成三角形的概率
   - **全局传递性 (Transitivity)**：整体三角形闭合率
   - 意义：衡量局部密集性，高值表示"朋友的朋友也是朋友"的网络特性

4. **社区结构 (Community Structure)**
   - **社区数量 (# Communities)**：使用贪婪模块度算法检测的社区数
   - **模块度 (Modularity)**：社区内部连接强于社区间连接的程度 (0-1)
   - **桥节点数量**：跨社区连接的关键节点数 (Participation Coefficient > 0.5)
   - **核心节点数量**：社区内高连接度节点数 (Within-module Z-score > 1.0)

5. **度分布 (Degree Distribution)**
   - **平均/中位数/最大度**：节点连接数统计
   - **度为1的节点比例**：叶子节点占比，反映边缘化程度
   - **度同配性 (Degree Assortativity)**：高度节点倾向连接高度节点的程度
     - 正值：相似度节点互联（社交网络特征）
     - 负值：中心-边缘结构（hub连接叶子节点）

**可视化输出**：
- 度分布直方图 (topology_degree_hist.png)
- 度分布对数图 (topology_degree_loglog.png)：检测是否符合幂律分布
- 社区大小排名图 (topology_community_sizes.png)

---

### 3. 语义-距离相关性评估 (Semantic Similarity vs. Graph Distance)

#### 详细说明
**目的**：验证图谱是否符合"语义相似的实体在图中距离更近"的假设，检测图结构与语义的对齐程度。

**方法**：
1. 对所有节点标签进行语义嵌入 (paraphrase-MiniLM-L3-v2模型)
2. 随机采样3000对连通节点
3. 计算每对节点的：
   - **语义相似度**：嵌入向量余弦相似度 (0-1)
   - **图距离**：最短路径跳数
4. 计算 Spearman 秩相关系数

**核心指标**：
- **Spearman 相关系数 (ρ)**
  - 期望值：显著负相关 (ρ < 0)
  - 意义：值越负，表示语义越相似的实体图距离越近
  - 统计显著性：p-value < 0.05 认为相关性显著

**结果解读**：
- ρ ≈ -0.1, p < 0.01：弱负相关但统计显著，图结构部分反映语义
- ρ ≈ 0, p > 0.05：无显著相关，图结构与语义脱节
- ρ < -0.3, p < 0.001：强负相关，图结构良好反映语义

**可视化输出**：
- 散点图 (textsim_vs_distance_scatter.png)：语义相似度 vs 图距离
- 箱线图 (textsim_vs_distance_box.png)：按图距离分组的语义相似度分布

---

### 4. 链接预测评估 (Link Prediction)

#### 详细说明
**目的**：评估图谱结构的可预测性和逻辑完整性，间接反映知识质量。

**方法**：
1. 随机隐藏10%的边作为测试集（正样本）
2. 从不存在的边中采样等量负样本
3. 使用三种无监督算法对候选边打分：
   - **Adamic-Adar**：基于共同邻居的逆度数加权
   - **Jaccard 系数**：共同邻居比例
   - **资源分配指数 (Resource Allocation)**：共同邻居的度倒数和

**核心指标**：
1. **PR-AUC (Precision-Recall曲线下面积)**
   - 范围：0.5-1.0（0.5为随机基线）
   - 意义：在不平衡数据下的分类性能，值越高越好

2. **ROC-AUC**
   - 范围：0.5-1.0（0.5为随机基线）
   - 意义：真正例率与假正例率的权衡

3. **P@K / R@K (Top-K精确率/召回率)**
   - K=50：考察模型对最可能存在的50条边的预测准确性
   - P@K：Top-K中真实存在的边的比例
   - R@K：Top-K覆盖所有真实边的比例

**结果解读**：
- AUC > 0.7：结构规律性强，可预测性好
- AUC ≈ 0.5：结构接近随机，规律性弱
- P@50 > 0.8：高置信度预测准确

**可视化输出**：
- AUC对比柱状图 (linkpred_auc_compare.png)
- P@K和R@K对比图 (linkpred_pr_compare.png)

---

### 5. Bootstrap一致性评估 (Bootstrap Consistency)

#### 详细说明
**目的**：评估图谱在边扰动下的稳定性，检测结构是否过度依赖少数边。

**方法**：
1. 对原图进行20次Bootstrap采样（每次随机采样90%的边）
2. 每次采样后计算语义邻居与图邻居的Jaccard相似度
3. 分析相似度在不同采样中的均值和标准差

**核心指标**：
- **平均Jaccard相似度**：语义kNN与图kNN的重叠度
- **标准差**：反映稳定性，值越小表示结构越鲁棒

**结果解读**：
- 均值 > 0.3, 标准差 < 0.05：结构稳定，语义对齐好
- 均值低或标准差大：结构脆弱或语义不对齐

---

## Poster简略版说明

### 评估框架概述
**5维评估体系** 全面衡量知识图谱质量

---

### 1. 实体一致性 ⭐
**指标**：UER / TCR / NAE  
**方法**：Sentence-BERT + 层次聚类  
**意义**：衡量实体去重质量和类型一致性

---

### 2. 拓扑鲁棒性 🌐
**指标**：巨分量比例 / 平均路径长度 / 模块度 / 度同配性  
**方法**：图论分析（连通性、社区、度分布）  
**意义**：评估结构健壮性和信息流通效率

---

### 3. 语义-距离对齐 🔗
**指标**：Spearman ρ (语义相似度 vs 图距离)  
**方法**：随机采样节点对 + 相关性检验  
**意义**：验证"相似实体距离近"假设

---

### 4. 链接预测 🎯
**指标**：PR-AUC / ROC-AUC / P@K  
**方法**：Holdout + 无监督打分算法  
**意义**：结构可预测性和知识完整性

---

### 5. Bootstrap一致性 🔄
**指标**：Jaccard相似度均值/标准差  
**方法**：边重采样 + 邻居稳定性分析  
**意义**：结构对扰动的鲁棒性

---

## KG1可视化结果解读

### 数据规模
- **节点数**：11,400
- **边数**：约14,334
- **实体簇数**：8,579

---

### 1. 实体一致性 (Entity Consistency)

#### 指标结果
- **UER = 0.8805** (88.05%的簇是唯一实体)
- **TCR = 1.0** (100%类型一致，无类型冲突)
- **NAE = 0.0** (命名无歧义)

#### 可视化解读

**cluster_size_hist.png (簇大小分布)**
- **观察**：绝大多数簇大小为1-2，极少数大簇
- **解读**：去重效果良好，大部分实体是唯一的；少数大簇可能是：
  - 真实的同义实体聚合（如"美国"、"USA"）
  - 过度泛化的聚类（需人工检查）

**typecount_hist.png (簇内类型数分布)**
- **观察**：所有簇的类型数均为1
- **解读**：完美的类型一致性，没有"同一实体被标注多种类型"的问题

**amb_cluster_*.png (歧义簇类型分布)**
- **簇9, 43, 51等**：虽然类型一致，但簇大小较大
- **可能原因**：
  - 通用词汇被过度聚类（如"发展"、"影响"）
  - 需要调整聚类阈值或人工审查

---

### 2. 拓扑结构 (Topology)

#### 指标结果
**连通性**：
- 巨分量比例 = 0.8521 (85.21%节点在最大连通图中)
- 连通分量数 = 524
- 平均分量大小 = 21.76

**路径**：
- 平均最短路径 = 4.57跳
- 直径 = 15跳

**聚类**：
- 平均聚类系数 = 0.0104 (低，图稀疏)
- 全局传递性 = 0.0004 (极低，几乎无三角形结构)

**社区**：
- 社区数 = 595
- 模块度 = 0.8364 (高，社区划分清晰)
- 桥节点数 = 155
- 核心节点数 = 537

**度分布**：
- 平均度 = 2.51
- 中位数度 = 1（大量叶子节点）
- 最大度 = 1,547 (存在超级Hub)
- 度为1节点占比 = 66.86%
- 度同配性 = -0.2006 (负值：中心-边缘结构)

#### 可视化解读

**topology_degree_hist.png (度分布直方图)**
- **观察**：严重右偏，大量低度节点，少数高度Hub
- **解读**：
  - 典型的"星型"或"中心-辐射"结构
  - 66.86%的节点只有1条边（叶子节点）
  - 知识集中在少数核心实体上

**topology_degree_loglog.png (度分布对数图)**
- **观察**：近似线性下降
- **解读**：
  - 符合幂律分布特征（无标度网络）
  - 少数Hub节点控制大量连接
  - 这是很多真实知识网络的特征

**topology_community_sizes.png (社区大小排名)**
- **观察**：前10社区规模差异大，长尾效应明显
  - 最大社区：2,054节点
  - 第10大社区：213节点
  - 大量小社区（2-3节点）
- **解读**：
  - 知识分布不均，主题聚集明显
  - 大社区可能对应主要事件/领域
  - 小社区可能是孤立知识片段

**综合评价**：
- ✅ **优点**：
  - 高模块度 (0.836) 表示主题划分清晰
  - 高巨分量比例 (85.21%) 表示核心知识连通性好
- ⚠️ **问题**：
  - 平均路径较长 (4.57)，知识检索可能需要多跳
  - 低聚类系数，缺乏密集子结构（知识网络稀疏）
  - 高度集中在Hub（可能存在过度依赖某些中心实体）

---

### 3. 链接预测 (Link Prediction)

#### 指标结果
| 算法 | PR-AUC | ROC-AUC | P@50 | R@50 |
|------|--------|---------|------|------|
| Adamic-Adar | 0.5224 | 0.5091 | 0.92 | 0.0321 |
| Jaccard | 0.4972 | 0.5006 | 0.50 | 0.0174 |
| Resource Allocation | 0.5077 | 0.5008 | 0.50 | 0.0174 |

#### 可视化解读

**linkpred_auc_compare.png (AUC对比)**
- **观察**：所有算法AUC接近0.5（随机基线）
- **解读**：
  - 图结构可预测性弱
  - 边的生成更多依赖语义而非结构规律
  - 符合知识图谱特点（非社交网络）

**linkpred_pr_compare.png (P@K和R@K对比)**
- **观察**：Adamic-Adar的P@50达到0.92
- **解读**：
  - 虽然整体AUC低，但Top预测准确率高
  - 适合"推荐最可能的K条边"任务
  - 基于共同邻居的方法在知识图谱中有效

---

### 4. 语义-距离相关性 (Semantic Similarity)

#### 指标结果
- **Spearman ρ = -0.1004**
- **p-value = 2.69e-06** (高度显著)
- **样本数 = 2,177**

#### 可视化解读

**textsim_vs_distance_scatter.png (散点图)**
- **观察**：语义相似度随图距离增加而下降
- **解读**：
  - 弱负相关 (ρ=-0.1) 但统计显著
  - 图结构部分反映语义关系
  - 存在优化空间：可通过增加语义边提升对齐

**textsim_vs_distance_box.png (箱线图)**
- **观察**：距离1-2跳的节点语义相似度明显高于3+跳
- **解读**：
  - 直接邻居确实更相似（符合预期）
  - 但远距离节点仍有分散（可能是跨主题链接）

**综合评价**：
- ρ=-0.1 在知识图谱中属于合理水平
- 相比社交网络（ρ通常 -0.3到-0.5），知识图谱的语义对齐更弱
- 建议：可考虑增加基于语义的边生成

---

## Trans可视化结果解读

### 数据规模
- **节点数**：33,781
- **边数**：约53,317
- **实体簇数**：32,231

---

### 1. 实体一致性 (Entity Consistency)

#### 指标结果
- **UER = 0.9604** (96.04%的簇是唯一实体)
- **TCR = 0.9931** (99.31%类型一致)
- **NAE = 0.0036** (极低歧义)

#### 可视化解读

**cluster_size_hist.png**
- **观察**：相比KG1，更高比例的单节点簇
- **解读**：
  - Trans图谱去重效果更好 (UER提升8%)
  - 可能原因：数据源更规范或实体定义更明确

**typecount_hist.png**
- **观察**：99.31%簇类型一致，仅0.69%存在类型混合
- **解读**：
  - 极少数实体存在类型歧义（如"Apple"既是公司又是水果）
  - 整体类型标注质量极高

**amb_cluster_*.png**
- **簇31, 41, 68等**：类型分布相对均匀
- **可能需要人工检查**：
  - 是否为真实的多义词（需要拆分）
  - 或是类型粒度问题（需要统一分类标准）

---

### 2. 拓扑结构 (Topology)

#### 指标结果
**连通性**：
- 巨分量比例 = 0.8072 (80.72%)
- 连通分量数 = 3,048
- 平均分量大小 = 11.08

**路径**：
- 平均最短路径 = null (图过大，未计算)
- 直径 = null

**聚类**：
- 平均聚类系数 = 0.0458 (高于KG1)
- 全局传递性 = 0.0136 (高于KG1)

**社区**：
- 社区数 = 3,270
- 模块度 = 0.5680 (中等)
- 桥节点数 = 2,233
- 核心节点数 = 847

**度分布**：
- 平均度 = 3.15
- 中位数度 = 1
- 最大度 = 3,027
- 度为1节点占比 = 75.25%
- 度同配性 = -0.1563

#### 可视化解读

**topology_degree_hist.png**
- **观察**：与KG1类似的右偏分布，但平均度更高
- **解读**：
  - Trans图谱更密集（平均度3.15 vs 2.51）
  - 但仍有75%节点为叶子节点

**topology_degree_loglog.png**
- **观察**：明显的幂律分布
- **解读**：
  - 更典型的无标度网络特征
  - Hub节点（如"COVID-19"、"美国"）可能连接数千节点

**topology_community_sizes.png**
- **观察**：
  - 最大两社区规模接近（6,056 vs 5,927）
  - 前10社区占据大部分节点
- **解读**：
  - 知识分布相对均衡（相比KG1）
  - 可能对应不同时间段或主题域

**综合评价**：
- ✅ **优点**：
  - 更高的聚类系数 (0.046 vs 0.010) 表示局部结构更密集
  - 更多三角形结构（传递性提升30倍）
  - 平均度更高（知识更密集）
- ⚠️ **问题**：
  - 模块度较低 (0.568 vs 0.836)，社区边界不如KG1清晰
  - 更多连通分量 (3,048 vs 524)，碎片化程度更高
  - 巨分量比例略低 (80.72% vs 85.21%)

---

### 3. 语义-距离相关性 (Semantic Similarity)

#### 指标结果
- **Spearman ρ = -0.0354**
- **p-value = 0.1178** (不显著)
- **样本数 = 1,955**

#### 可视化解读

**textsim_vs_distance_scatter.png**
- **观察**：散点几乎无明显趋势
- **解读**：
  - 相关性极弱且不显著 (p>0.05)
  - 图结构与语义几乎脱节
  - **可能原因**：
    - 边的生成更依赖时间/事件关系而非语义相似
    - Trans过程可能引入了跨领域链接

**textsim_vs_distance_box.png**
- **观察**：各距离组的语义相似度分布几乎无差异
- **解读**：
  - 验证了相关性分析结果
  - 建议：如果应用需要语义检索，可考虑添加语义边

**综合评价**：
- ⚠️ **问题**：语义-结构对齐较差
- 💡 **建议**：
  - 补充基于语义的边生成
  - 或调整边的权重策略

---

## 对比总结：KG1 vs Trans

### 规模对比
| 指标 | KG1 | Trans | 变化 |
|------|-----|-------|------|
| 节点数 | 11,400 | 33,781 | +196% |
| 边数 | ~14,334 | ~53,317 | +272% |
| 平均度 | 2.51 | 3.15 | +25% |

### 质量对比
| 维度 | KG1 | Trans | 对比 |
|------|-----|-------|------|
| **实体一致性** | | | |
| UER | 88.05% | 96.04% | ✅ Trans更好 |
| TCR | 100% | 99.31% | ⚠️ KG1略好 |
| **拓扑鲁棒性** | | | |
| 巨分量比例 | 85.21% | 80.72% | ⚠️ KG1更好 |
| 模块度 | 0.836 | 0.568 | ⚠️ KG1更好 |
| 聚类系数 | 0.010 | 0.046 | ✅ Trans更好 |
| **语义对齐** | | | |
| Spearman ρ | -0.100*** | -0.035 n.s. | ⚠️ KG1更好 |
| **链接预测** | | | |
| 最佳AUC | 0.522 | - | - |

### 特点总结

**KG1**：
- ✅ 社区结构清晰（高模块度）
- ✅ 语义-结构对齐较好
- ✅ 连通性更强
- ⚠️ 去重效果一般
- ⚠️ 图稀疏（低聚类系数）

**Trans**：
- ✅ 实体去重效果优秀
- ✅ 局部结构更密集
- ✅ 规模更大
- ⚠️ 社区边界模糊
- ⚠️ 语义-结构脱节
- ⚠️ 碎片化程度高

### 应用建议

**KG1适用于**：
- 需要主题/领域明确划分的场景
- 基于图结构的语义推理
- 社区检测和模块化分析

**Trans适用于**：
- 需要高实体质量的场景
- 大规模知识覆盖
- 局部邻域查询

---

## Poster用图表建议

### 推荐可视化图表

1. **实体一致性**：
   - `cluster_size_hist.png`（显示去重效果）
   - `typecount_hist.png`（显示类型一致性）

2. **拓扑结构**：
   - `topology_degree_loglog.png`（展示幂律分布，科学感强）
   - `topology_community_sizes.png`（展示主题分布）

3. **语义对齐**：
   - `textsim_vs_distance_box.png`（比scatter图更清晰）

4. **链接预测**：
   - `linkpred_auc_compare.png`（对比三种算法）

### Poster布局建议

```
┌─────────────────────────────────────────────┐
│         知识图谱质量评估框架                 │
│              (5维评估体系)                   │
├─────────────────────────────────────────────┤
│                                             │
│  [1. 实体一致性]  [2. 拓扑鲁棒性]            │
│   📊 柱状图        📈 幂律分布图             │
│   UER: 96%        度分布遵循幂律              │
│   TCR: 99%        模块度: 0.57-0.84          │
│                                             │
├─────────────────────────────────────────────┤
│  [3. 语义对齐]     [4. 链接预测]             │
│   📉 箱线图         📊 AUC对比               │
│   ρ=-0.1*         Adamic-Adar最佳           │
│                                             │
├─────────────────────────────────────────────┤
│  [5. Bootstrap一致性]  [对比分析: KG1 vs Trans] │
│   结构鲁棒性检验         规模与质量权衡         │
└─────────────────────────────────────────────┘
```

---

## 参考文献

1. Sentence-BERT: Reimers & Gurevych (2019)
2. 社区检测: Newman (2006) - Modularity算法
3. 链接预测: Liben-Nowell & Kleinberg (2007)
4. 知识图谱评估综述: Paulheim (2017)

---

**文档生成日期**: 2024年11月  
**版本**: 1.0  
**适用图谱**: KG1, Trans

